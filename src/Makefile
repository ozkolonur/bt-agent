CONFIG_CLIENT_HELLO=y
CONFIG_CLIENT_HTTP_GET=y
CONFIG_CLIENT_HTTP_GET_MD5=y
CONFIG_CLIENT_TCP_JSON=y
CONFIG_DRIVER_HELLO=y
CONFIG_DRIVER_RFCOMM_MYTECH=n
CONFIG_DRIVER_RFSOCK_MYTECH=y
CONFIG_DRIVER_AVITA=y
CONFIG_DRIVER_AVITA_BS=y
CONFIG_DRIVER_MGH=y

#trailing slash is important - last character /
HTTP_GET_MINING_PLATFORM="http://well.io/mining_platform/http_get/"
SVN_REV := $(shell svnversion -n .)

TARGET=bt-agent
CC=$(CROSS_COMPILE)gcc
CFLAGS-y=$(CFLAGS) -g -ggdb -Wall -DSVN_REVISION=\"$(SVN_REV)\" -DVERBOSE_ENABLED
LDFLAGS-y=$(LDFLAGS) -lcurl -lbluetooth -lpthread

OBJS-y = main.o hexdump.o kvlist.o driver.o logger.o  
OBJS-$(CONFIG_CLIENT_HELLO) += client_hello.o
OBJS-$(CONFIG_CLIENT_HTTP_GET) += client_http_get.o
OBJS-$(CONFIG_CLIENT_TCP_JSON) += client_tcp_json.o
OBJS-$(CONFIG_CLIENT_HTTP_GET_MD5) += client_http_get_md5.o md5.o
OBJS-$(CONFIG_DRIVER_HELLO) += driver_hello.o
OBJS-$(CONFIG_DRIVER_RFCOMM_MYTECH) += driver_rfcomm_mytech.o
OBJS-$(CONFIG_DRIVER_RFSOCK_MYTECH) += driver_rfsock_mytech.o
OBJS-$(CONFIG_DRIVER_AVITA) += driver_avita.o
OBJS-$(CONFIG_DRIVER_AVITA_BS) += driver_avita_bs.o
OBJS-$(CONFIG_DRIVER_MGH) += driver_mgh.o


CFLAGS-$(CONFIG_CLIENT_HELLO) += -DCLIENT_HELLO
CFLAGS-$(CONFIG_CLIENT_HTTP_GET) += -DCLIENT_HTTP_GET -DHTTP_GET_MINING_PLATFORM=\"$(HTTP_GET_MINING_PLATFORM)\"
CFLAGS-$(CONFIG_CLIENT_HTTP_GET_MD5) += -DCLIENT_HTTP_GET_MD5 -DHTTP_GET_MINING_PLATFORM=\"$(HTTP_GET_MINING_PLATFORM)\"
CFLAGS-$(CONFIG_CLIENT_TCP_JSON) += -DCLIENT_TCP_JSON
CFLAGS-$(CONFIG_DRIVER_HELLO) += -DDRIVER_HELLO
CFLAGS-$(CONFIG_DRIVER_RFCOMM_MYTECH) += -DDEVICE_RFCOMM_MYTECH
CFLAGS-$(CONFIG_DRIVER_RFSOCK_MYTECH) += -DDRIVER_RFSOCK_MYTECH
CFLAGS-$(CONFIG_DRIVER_AVITA) += -DDRIVER_AVITA
CFLAGS-$(CONFIG_DRIVER_AVITA_BS) += -DDRIVER_AVITA_BS
CFLAGS-$(CONFIG_DRIVER_MGH) += -DDRIVER_MGH

LDFLAGS-$(CONFIG_CLIENT_HELLO) += 
LDFLAGS-$(CONFIG_CLIENT_HTTP_GET) += -lcurl
LDFLAGS-$(CONFIG_CLIENT_HTTP_GET_MD5) += -lcurl
LDFLAGS-$(CONFIG_DRIVER_HELLO) += 
LDFLAGS-$(CONFIG_DRIVER_RFSOCK_MYTECH) +=
LDFLAGS-$(CONFIG_DRIVER_AVITA) +=
LDFLAGS-$(CONFIG_DRIVER_MGH) +=


$(TARGET): $(OBJS-y)
	$(CC) $(CFLAGS-y) -o $(TARGET) $(OBJS-y) $(LDFLAGS-y)

send_sock:
	$(CC) send_sock.c -o send_sock

all:
	gcc main.c client_hello.c -o agent

%.o: %.c
	$(CC) $(CFLAGS-y) -c $<

clean:
	rm -rf $(TARGET) $(OBJS-y)

docs:
	doxygen Doxyfile
